<!DOCTYPE html>
<html>
  <head>
    <!-- A-Frame libraries -->
    <script src="https://aframe.io/releases/0.8.0/aframe.min.js"></script>
    <script src="https://cdn.rawgit.com/delapuente/aframe-sharedspace-component/master/dist/aframe-sharedspace-component.min.js"></script>
    <script src="https://rawgit.com/feiss/aframe-environment-component/master/dist/aframe-environment-component.min.js"></script>
  </head>
  <body>
    <a-scene>
      <a-entity sharedspace="hold: true" avatars>
        <a-entity environment="preset:forest"></a-entity>
      </a-entity>
    </a-scene>
    <template>
      <a-sphere radius="0.1" color="#ff0000"></a-sphere>
    </template>
    <script>
      var scene = document.querySelector('a-scene');

      (function start() {
        if (!scene.hasLoaded) {
          scene.addEventListener('loaded', start);
          return;
        }

        var prefix = window.location.host.split('.')[0] + '-';
        var currentUrl = new URL(window.location);
        var roomName = currentUrl.search.substr(1);
        if (!roomName) {
          roomName = prefix + Date.now();
          currentUrl.search = roomName;
          history.pushState({}, '', currentUrl.href);
        }

        var room = document.querySelector('[sharedspace]');
        room.setAttribute('sharedspace', { room: roomName, hold: false });
      }());
    </script>
  </body>
</html>
